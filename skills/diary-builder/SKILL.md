---
name: diary-builder
description: 柳比歇夫日志格式化与追问中间件。将零散粗糙的间歇性记录，完善为小时级粒度的时间日志。保留原文、仅做补充、分类留给 day-reflection。
version: 2.0.0
---

# diary-builder（日记构建器）

## 定位

**一句话描述**：将零散、粗糙的间歇性记录，完善为小时级粒度的时间日志。

**核心价值**：消除记录盲区，确保每一天都有完整可追溯的时间线。

**关键原则**：
- **原文神圣**：原始记录一字不改，完整保留
- **仅做补充**：只在空白时段添加记录，以 `[补充]` 明确标记
- **分类后置**：标签、统计、洞察全交给 day-reflection

---

## 核心工作流

### 第一步：识别与分类 (Parse)

读取用户日记中的间歇性记录，按类型分类处理：

| 类型 | 特征 | 处理方式 |
|------|------|----------|
| **常规动作** | 起床、洗漱、睡觉、到达某地 | 无需追问，直接保留 |
| **含糊动作** | "继续玩"、"弄完了"、"排队" | 追问具体对象、场景、感受 |
| **认知/思绪** | 突然的感悟、想法、洞察 | 追问触发这个思考的具体事件 |
| **深度工作** | 写代码、学习、创作 | 追问产出、遇到的问题、心流状态 |

### 第二步：时间线分析 (Analyze)

```
1. 识别已有记录的时间点（保留原样）
2. 计算记录间的时间间隔
3. 标记超过1小时的空白时段 → 【时段空白】待补充
4. 标记描述模糊的记录 → 【信息模糊】待澄清
5. 标记认知类记录 → 【思绪溯源】待追问触发源
```

### 第三步：批量追问 (Inquiry)

**追问原则**：
- 批量展示，编号提问
- 选项式回答为主，开放式为辅
- 用户可用 `1.A 2.B 3.自定义` 格式快速回复

**追问类型**：

**【时段空白】** - 补全时间线
```
1. 11:00-13:00（2小时空白）这段时间在做什么？
   A. 游览钟楼及周边  B. 午餐+休息  C. 其他：____
```

**【信息模糊】** - 澄清具体内容
```
2. 10:06 "出发继续玩" — "玩"的具体内容是？
   A. 游览景点  B. 购物逛街  C. 其他：____
```

**【思绪溯源】** - 追问认知触发源
```
3. 13:23 关于"日记记录方式过于理性"的思考 —
   是什么触发了这个想法？（看到什么、听到什么、经历了什么）
```

**【深度工作补充】** - 丰富产出细节
```
4. 23:35 "完成基础日志相关skills" —
   具体完成了哪些？遇到了什么难题？
   A. 写了文档  B. 调试了代码  C. 其他：____
```

### 第四步：生成完善记录 (Build)

**输出格式**：
按时间顺序融合，补充记录以 `[补充]` 标记插入到对应位置：

```markdown
## ⌚️ 间歇性记录

[补充] 07:00 起床
10:06 出发继续玩。
[补充] 10:06-11:00 从酒店步行至钟楼，沿途游览街景
11:00 到达钟楼
13:00 吃了水盆羊肉 然后再来碑林。
13:23 我对这些古建筑的文物没什么太多的兴趣，但我爸倒是拍得津津有味。
13:23 之前感觉这种现代式的记录方式过于理性...
13:36 所以说，我现在的记录似乎并没有把我想要记录的东西给记录下来...
[补充] 13:36-15:00 从碑林前往城墙，文昌门步行至永安门
[补充] 15:00-18:02 大雁塔游览，后逛大唐不夜城
18:02 逛了大唐不夜城，往回赶了。
...
[补充] 21:20-22:14 整理资料，撰写分享文章大纲
[补充] 22:14-23:00 研究agent命名策略
23:35 把基础的日志相关skills完成了
```

**关键原则**：
- 原始记录一字不改，保持原位置
- 补充记录按时间顺序插入到合适位置
- 所有补充以 `[补充]` 前缀明确标记
- 保持时间线从上到下递增

---

## 原文处理原则

| 场景 | 处理方式 | 示例 |
|------|----------|------|
| 原始记录 | 一字不改，原样保留 | `10:06 出发继续玩。` |
| 碎碎念/感悟 | 保留，不删减 | `13:23 之前感觉这种现代式的记录方式过于理性...` |
| 主观感受 | 保留，不做评判 | `我对这些古建筑的文物没什么太多的兴趣` |
| 时间模糊 | 保留原样 | `下午` → 不强制改为 `14:00` |

---

## 补充记录规范

- **前缀**：必须以 `[补充]` 开头
- **时间格式**：尽可能精确到整点或半点
- **位置**：按时间顺序插入，保持时间线完整
- **内容**：客观描述做了什么，不加评判

---

## 睡眠时段识别

**自动跳过追问的情况**：
1. 时间范围在 23:00 - 08:00 之间，且描述包含"睡"、"休息"
2. 连续空白超过 6 小时，且横跨午夜
3. 用户明确标记休息的时段

---

## 边界情况处理

| 场景 | 处理方式 |
|------|----------|
| 完全没有记录 | 提示"今天还没有记录，请先简单写下几个时间点" |
| 只有1条记录 | 以该记录为锚点，向前向后询问 |
| 记录跨度不完整（缺少上午） | 询问"上午的时间怎么安排的？" |
| 用户说"记不清了" | 记录为 `[补充] XX:XX 记忆模糊时段`，不强迫回忆 |
| 时间冲突（两条记录重叠） | 标记冲突，询问"这段时间同时在做什么？" |

---

## 与 day-reflection 的职责分离

| 维度 | diary-builder | day-reflection |
|------|---------------|----------------|
| **核心任务** | 内容丰富、补全时间线 | 分类标签、时间统计、洞察分析 |
| **是否修改原文** | 否，仅添加补充 | 否，仅追加新章节 |
| **标签分类** | ❌ 不做 | ✅ 柳比歇夫五类时间 |
| **专注度/能量** | ❌ 不标记 | ✅ 统计和可视化 |
| **洞察建议** | ❌ 不生成 | ✅ 身份检查、明日行动 |

---

## 使用方法

```bash
/diary-builder [日期]
```

**参数**：
- `日期`：可选，格式 `YYYY-MM-DD` 或 `YYYY_MM_DD`，默认为今天

**示例**：
```bash
/diary-builder           # 完善今天的记录
/diary-builder 2026-02-20 # 完善指定日期
```

---

## 完整交互示例

**用户**：`/diary-builder 2026-02-20`

**AI**：
```
读取到 2026_02_20.md 的现有记录：

00:12 躺着，准备洗漱休息了。
10:06 出发继续玩。
11:00 到达钟楼
13:00 吃了水盆羊肉 然后再来碑林。
...

发现需要澄清的地方：

【时段空白】
1. 10:06-11:00（近1小时）从酒店到钟楼的路上？
   A. 步行游览  B. 乘车直达  C. 其他：____

2. 13:36-18:02（4.5小时空白）具体行程是？
   A. 直接回酒店休息了
   B. 去了其他景点（请描述）
   C. 其他：____

【信息模糊】
3. 10:06 "出发继续玩" — 具体去哪里？
   A. 钟楼  B. 其他景点  C. 不确定

请用 "1.A 2.B 3.A" 的格式回答，或输入"跳过"：
```

**用户**：`1.A 2.B 3.A` + `去了城墙，然后大雁塔`

**AI**：
```
基于你的回答，完善后的记录如下：

## ⌚️ 间歇性记录

00:12 躺着，准备洗漱休息了。
[补充] 07:00 起床
10:06 出发继续玩。
[补充] 10:06-11:00 从酒店步行至钟楼，沿途游览街景
11:00 到达钟楼
13:00 吃了水盆羊肉 然后再来碑林。
13:23 我对这些古建筑的文物没什么太多的兴趣...
[补充] 13:36-15:00 前往城墙，从文昌门步行至永安门
[补充] 15:00-18:02 游览大雁塔，后逛大唐不夜城
18:02 逛了大唐不夜城，往回赶了。
...

确认保存？ [确认] [修改] [取消]
```

**用户**：`确认`

**AI**：`已保存。如需时间统计和洞察分析，运行 /day-reflection 2026-02-20`

---

## 禁止事项

❌ **diary-builder 不做以下事情**：
- 不删除或修改原始记录的任何文字
- 不添加标签分类（留给 day-reflection）
- 不标记专注度或能量水平
- 不生成洞察或建议
- 不做时间统计或效率分析
- 不输出每日总结

---

## 调用顺序

```
/diary-builder → /day-reflection
      ↓                ↓
  完善记录       统计 + 洞察 + 建议
```

**必须先运行 diary-builder，再运行 day-reflection。**
