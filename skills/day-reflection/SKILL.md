---
name: day-reflection
description: 基于结构化时间日志，进行柳比歇夫式时间统计，发现行为模式，生成推动身份改变的洞察与犀利建议。周日自动提醒周回顾。
version: 1.0.0
---

# day-reflection（日复盘）

## 定位

基于结构化时间日志，进行柳比歇夫式时间统计，发现行为模式，生成推动身份改变的洞察与犀利建议。

**核心价值**：
1. **时间可视化** - 精确统计时间分配，发现"时间黑洞"
2. **模式洞察** - 识别高效/低效时段，发现行为规律
3. **身份检查** - 对比今日行为与长期目标，暴露错位（犀利直接）
4. **明日行动** - 给出一个可立即执行的小改变
5. **周日提醒** - 周日自动提醒进行周回顾

**关键约束**：
- 不修改原始间歇性记录
- 不生成收集箱条目
- 不做跨日对比（留给 future /weekly-review）
- 风格犀利直接，无边界

---

## 输入

**来源1**：diary-builder 完善后的间歇性记录

**来源2**：`2-长期项目/人生目标.md`

**输入格式示例**：
```markdown
09:30 [4] [高] 地铁通勤，阅读《深度工作》30分钟 #学习 #阅读
10:00 [3] [中] 处理邮件和昨日待办 #工作 #日常
12:00 [3] [中] 午餐，与同事聊项目进度 #生活
14:00 [2] [低] 项目评审会议，讨论Q3规划 #工作 #会议
18:00 [4] [高] 下班通勤，听播客《聊聊React 19》 #学习
23:00 [1] [低] 刷短视频，准备睡觉 #休息
```

---

## 输出

**输出位置**：追加到日记文件末尾，作为独立章节

**输出结构（四层）**：

```markdown
## ⏱️ 日复盘

### L1: 时间统计

#### 六类时间分配

| 类别 | 时长 | 占比 | 平均专注度 |
|------|------|------|-----------|
| 🟢 核心工作 | 6h | 37.5% | 2.5 |
| 🔵 个人发展 | 2.5h | 15.6% | 4.0 |
| 🟡 生活管理 | 2h | 12.5% | 3.0 |
| 🟠 社交娱乐 | 0h | 0% | - |
| ⚪ 休息 | 5.5h | 34.4% | - |
| 🔴 消耗（黑洞）| 2h | 12.5% | 1.0 |

**合计清醒时间**：16.5h

#### 时间线可视化

```
图例：时间段 █=15分钟  T=时长  F=专注度(1-5)  E=能量(高/中/低)  ←高效/黑洞

09:30-10:00 ████████ 通勤阅读 (T:30min, F:4, E:高)
10:00-12:00 ████████████████ 深度工作 (T:2h, F:5, E:高) ←高效
...
23:00-01:00 ████████████████ 刷短视频 (T:2h, F:1, E:低) ←黑洞
```

---

### L2: 模式洞察

**高效时段**：09:30-10:30（专注度4，持续1h）
- 模式：通勤时的深度学习

**时间黑洞**：23:00-01:00（专注度1，持续2h）
- 问题：睡前刷短视频，影响睡眠质量

**能量曲线**：上午高（4）→ 午后跌（2）→ 晚上微升（3）→ 睡前崩盘（1）

---

### L3: 身份检查

**今日投入TOP3**：
1. 工作：6h
2. 休息：5.5h
3. 消耗（刷视频）：2h

**目标角色**（来自人生目标文件）：
- 自媒体创作者（目标：每周7-8h内容创作）
- 投资初学者（目标：每周2-3h学习）
- 健康维护（目标：体脂率15%）

**错位检查**：
❌ 你今天投入0h在内容创作，但说要成为自媒体创作者
❌ 你今天投入0h在投资学习，但说要学习理财
✅ 你在通勤时学习，符合"终身学习者"身份

**直接指出**：
你在欺骗自己。你说要创业，但晚上2小时刷短视频。这不是"休息"，是逃避。真正的休息是睡眠或冥想，不是多巴胺麻醉。

---

### L4: 明日行动

**一个小改变**：
明天睡前1小时（22:30-23:30），手机放客厅，床头放一本书。不是要求你读书，只是移除诱惑。

**本周关注**：
睡前刷视频已成为模式（连续3天）。这是焦虑的逃避行为。建议写一篇日记："我为什么不敢面对睡前的安静？"

---

### 周日提醒

今天是周日，该做周回顾了。
运行 `/weekly-review` 查看本周时间统计与目标进展。
```

---

## 六类时间定义

| 类别 | 定义 | 对应标签 | 颜色 |
|------|------|----------|------|
| 🟢 核心工作 | 产出直接价值的工作 | `#工作` + `#深度` | 绿色 |
| 🔵 个人发展 | 学习、阅读、技能提升 | `#学习` | 蓝色 |
| 🟡 生活管理 | 必要的日常事务 | `#生活` | 黄色 |
| 🟠 社交娱乐 | 有意识的社交、娱乐 | `#社交` | 橙色 |
| ⚪ 休息 | 睡眠、冥想、真正的放松 | `#休息` | 灰色 |
| 🔴 消耗/黑洞 | 无意识刷手机、拖延、发呆 | （专注度≤2且无产出）| 红色 |

**黑洞识别规则**：
- 专注度 ≤ 2
- 无明确产出
- 常见：无意识刷短视频、社交媒体、新闻
- 事后有"后悔"感（如"刷了半天不知道看了什么"）

---

## 身份检查机制

**读取文件**：`2-长期项目/人生目标.md`

**检查逻辑**：
```
今日时间统计
    ↓
对比人生目标中的"目标角色"
    ↓
计算"目标投入时间" vs "实际投入时间"
    ↓
生成直接反馈（犀利风格）
```

**反馈模板**：
- 完全匹配 → "今天你活成了你想要的样子。"
- 部分匹配 → "你在X上投入Y小时，符合Z身份。但A身份被忽视了。"
- 完全错位 → "你在欺骗自己。你说要X，但行动上全是Y。"

---

## 角色增减建议机制

**day-reflection 可以建议添加新角色**：
- 当检测到某类时间投入持续出现（连续14天），且不属于现有角色
- 建议格式（追加到人生目标文件）：
  ```
  - [🤖AI建议新增角色] 2026-02-21: 检测到连续14天投入"游戏开发"时间（平均2h/天），建议考虑新增"独立游戏开发者"角色。
    - 当前投入：X小时/周
    - 建议目标行为：...
    - 是否添加？[👤用户回复确认]
  ```

**day-reflection 可以建议删除/归档角色**：
- 当某角色连续30天投入为0，或用户明确表示放弃
- 建议格式（追加到人生目标文件）：
  ```
  - [🤖AI建议归档角色] 2026-02-21: "投资初学者"角色连续30天投入为0，是否归档此目标？
    - 归档意味着暂时从日常检查中移除
    - 可随时恢复
    - [👤用户回复：确认归档/继续保留]
  ```

**用户决策权**：
- 所有新增/删除/修改角色，必须经 [👤用户] 确认
- day-reflection 只提供建议，不自动修改

---

## 周日检测

**检测逻辑**：
```python
if date.weekday() == 6:  # 周日
    output += "\n---\n\n### 周日提醒\n\n今天是周日，该做周回顾了。\n运行 `/weekly-review` 查看本周时间统计与目标进展。"
```

---

## 人生目标文件格式

**路径**：`2-长期项目/人生目标.md`

**结构**：
```markdown
---
title: 人生目标
description: ...
---

# 人生目标

## 角色维度定义

### 1. 职业角色：自媒体创作者（含技术输出）

**目标身份**：...

**目标行为**（每月/每周）：
- ...

**关键指标**：
- ...

**当前状态**：...

### 2. 财务角色：投资初学者
...

## 时间预算总览

| 角色 | 每周目标投入 | 当前实际投入 | 差距 |
|------|-------------|-------------|------|
| ... | ... | ? | ? |

## 优先级
...

## 修改日志

| 日期 | 修改者 | 内容 |
|------|--------|------|
| ... | [👤用户] | ... |
| ... | [🤖AI建议] | ... |
```

---

## 边界情况处理

| 场景 | 处理方式 |
|------|----------|
| 记录太少（<5条） | 提示"记录不够详细，建议先用 diary-builder 完善" |
| 全是同一类别 | "今天只有工作记录，你的生活呢？" |
| 专注度都很低（平均<2） | "今天全程低能量，是生病还是逃避？" |
| 记录跨度过短（<6小时） | "只记录了部分时段，统计可能不准确" |
| 人生目标文件不存在 | 提示"请先创建 2-长期项目/人生目标.md" |

---

## 禁止事项

❌ **day-reflection 不做以下事情**：
- 不给模糊的安慰（"你已经很努力了"）
- 不输出多项建议（每天只给一个行动）
- 不比较昨日数据（历史对比留给 future /weekly-review）
- 不修改原始间歇性记录

---

## 使用方法

```bash
/day-reflection [日期]
```

**参数**：
- `日期`：可选，格式 `YYYY-MM-DD` 或 `YYYY_MM_DD`，默认为今天

**示例**：
```bash
/day-reflection           # 复盘今天
/day-reflection 2026-02-20 # 复盘指定日期
```

---

## 与 diary-builder 的关系

```
diary-builder → day-reflection
     ↓              ↓
完善记录      时间统计 + 洞察 + 行动建议
```

**调用顺序**：必须先运行 diary-builder，再运行 day-reflection。
